@model IEnumerable<Ecommerce.Models.Product>
@using Microsoft.AspNetCore.Http

@{
    var userRole = Context.Session.GetString("UserRole");
}

<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
    <h2 class="fw-bold text-dark">🛒 Products</h2>

    <div class="d-flex gap-2 mt-2 mt-md-0">
        @if (userRole == "Admin")
        {
            <a asp-action="Create" class="btn btn-success btn-sm shadow-sm">
                + Add Product
            </a>
        }

        <a asp-controller="Cart" asp-action="Index" class="btn btn-outline-dark position-relative btn-sm shadow-sm">
            Cart
            <span class="badge bg-danger ms-2">@ViewBag.CartCount</span>
        </a>
    </div>
</div>

<div class="row g-4">
    @foreach (var item in Model)
    {
        <div class="col-6 col-md-4 col-lg-3">
            <div class="product-card h-100 p-3 rounded-3 shadow-sm">
                <!-- Product Image -->
                <div class="product-img-container mb-3">
                    <img src="@item.ImagePath" alt="@item.Name" class="img-fluid rounded-3">
                </div>

                <!-- Product Details -->
                <h6 class="fw-bold text-truncate">@item.Name</h6>

                <p class="small text-muted mb-1 text-truncate">@item.Description</p>

                <div class="mt-auto d-grid gap-2">
                    <form asp-controller="Cart" asp-action="AddToCart" method="post">
                        <input type="hidden" name="id" value="@item.Id" />
                        <button type="submit" class="btn btn-primary btn-sm rounded-pill">
                            🛒 Add to Bag
                        </button>
                    </form>

                    <a asp-controller="Products" asp-action="Details" asp-route-id="@item.Id"
                       class="btn btn-outline-secondary btn-sm rounded-pill">
                        Details
                    </a>

                    @if (userRole == "Admin")
                    {
                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm rounded-pill">Edit</a>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm rounded-pill">Delete</a>
                    }
                </div>
            </div>
        </div>
    }
</div>

<style>
    /* Product Card Styling */
    .product-card {
        background: #fff;
        transition: all 0.2s ease-in-out;
        border: 1px solid #f1f1f1;
    }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
        }

    .product-img-container {
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

        .product-img-container img {
            max-height: 100%;
            max-width: 100%;
            object-fit: cover;
            transition: transform 0.3s ease-in-out;
        }

    .product-card:hover img {
        transform: scale(1.05);
    }

    .btn {
        font-weight: 500;
    }

    .text-truncate {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
